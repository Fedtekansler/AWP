<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<title>Exercise 1 - #3 Klotski</title>
    <style>
        #board {width: 400px;min-height:500px;margin: 0 auto;background-color:lightgray;position:relative;}
        .tile {position: absolute;}
        .yellow-vertical {width:100px;height:200px;}
        .red-big {width:200px;height:200px;}
        .yellow-horizontal {width:200px;height:100px;}
        .yellow-small {width:100px;height:100px;}
        .tile div {margin:5px;}
        .yellow-vertical div {width:90px;height:190px;background-color:yellow;}
        .red-big div  {width: 190px;height:190px;background-color:red;}
        .yellow-horizontal div {width: 190px;height:90px;background-color:yellow;}
        .yellow-small div {width: 90px;height:90px;background-color:yellow;}
    </style>
</head>
<body style="width:100%;">
	<h1>Exercise 1 - #3 Klotski</h1>
    <div id="board">

        <div style="top:000px;left:000px;" class="yellow-vertical tile">
            <div></div>
        </div>

        <div style="top:200px;left:000px;" class="yellow-vertical tile">
            <div></div>
        </div>

        <div style="top:000px;left:300px;" class="yellow-vertical tile">
            <div></div>
        </div>

        <div style="top:200px;left:300px;" class="yellow-vertical tile">
            <div></div>
        </div>

        <div style="top:000px;left:100px;" class="red-big tile">
            <div></div>
        </div>

        <div style="top:200px;left:100px;" class="yellow-horizontal tile">
            <div></div>
        </div>

        <div style="top:300px;left:100px;" class="yellow-small tile">
            <div></div>
        </div>

        <div style="top:300px;left:200px;" class="yellow-small tile">
            <div></div>
        </div>

        <div style="top:400px;left:300px;" class="yellow-small tile">
            <div></div>
        </div>

        <div style="top:400px;left:000px;" class="yellow-small tile">
            <div></div>
        </div>

    </div>

    <div style="width:400px; height:100px;position: relative; top: 0px;left:0px;margin:0 auto;">
        <div style="width:200px;height:100px;position: relative; left: 100px;background-color: lightgray"></div>
    </div>
	
	<script>
		/* Global variables --------------------------------------*/
		var tiles; // tile <div> elements
		var activeTile = null; // tile <div> element that the user last clicked. Null if none has been clicked
		
		/* Functions ---------------------------------------------*/
		function handleKeypress(event){
			switch(event.which){
				case 119: // W
					console.log("Pressed key W");
					tryMoveTile(activeTile, 0, -100);
					break;
				case 97: // A
					console.log("Pressed key A");
					tryMoveTile(activeTile, -100, 0);
					break;
				case 115: // S
					console.log("Pressed key S");
					tryMoveTile(activeTile, 0, 100);
					break;
				case 100: // D
					console.log("Pressed key D");
					tryMoveTile(activeTile, 100, 0);
					break;
			}
		}
		
		function handleTileClick(event){
			activeTile = this;
			console.log("Active tile ", activeTile);
			return false;
		}
		
		// Attempt to move tile by the given delta pixel amounts
		function tryMoveTile(tile, dxPixels, dyPixels){
			console.log("Try moving tile", tile, dxPixels, dyPixels);
			if(tile === null)
				return false;
			var x = parseInt(tile.style.left.replace(/px/,""));
			var y = parseInt(tile.style.top.replace(/px/,""));
			console.log(x, y);
			// TODO: check if valid before moving..
			tile.style.left = (x+dxPixels)+"px";
			tile.style.top = (y+dyPixels)+"px";
			return true;
		}
		
		/* Setup things ------------------------------------------*/
		// Add keypress listener to page
		document.body.addEventListener("keypress", handleKeypress);
		tiles = document.getElementsByClassName("tile");
		// Add click listeners to tiles.
		for(var i = 0; i < tiles.length; i++){
			tiles[i].addEventListener("click", handleTileClick);
		}
	</script>
</body>
</html>